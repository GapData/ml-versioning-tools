MlVTool
=======
Public repository for versioning machine learning data

Convention
----------

**Notebook metadata**: in this document it refers to the first code cell when it
is used to declare metadata such as parameters, dvc inputs/outputs, etc.


Tools
-----

**ipynb_to_python**: this command convert a given *Jupyter Notebook* to a
parameterized *Python3 script* (see specific syntax in section below)

    ipynb_to_python -n [notebook_path] -o [python_script_path]
    
**script_to_cmd**: this command create a python command wrapping a script 
generated by ipynb_to_python

    script_to_cmd -i [python_script] --out-py-cmd [python_command]
    


Jupyter Notebook syntax
-----------------------

The **Notebook metadata** cell is used to declare script parameters and **dvc** outputs and dependencies.
This can be done using basic docstring syntax. This docstring must be the first statement is this cell, only
comments can be writen above. 


### Good practices 

Avoid using relative paths in your Jupyter Notebook because they are relative to 
the notebook location which not be the same when it will be convert to a script.


### Parameterize

Parameter can be declared in the **Jupyter Notebook** using basic docstring syntax.
Those parameter description is used to generate parameterized python scripts and commands.

Parameters declaration in **Jupyter Notebook**:

**Jupyter Notebook**: process_files.ipynb

    
    #:param [type]? [param_name]: [description]?
    """
    :param str input_file: the input file
    :param output_file: the output_file
    :param rate: the rate
    :param int retry:
    """
    
Generated **Python3 script**:

    [...]
    def process_file(input_file: str, output_file, rate, retry:int):
        """
         ...
        """
    [...]

Generated command parameters:

    my_cmd -h
    
    usage: my_cmd [-h] --input-file INPUT_FILE --output-file OUTPUT_FILE --rate
                 RATE --retry RETRY
    
    Command for script [script_name]
    
    optional arguments:
      -h, --help            show this help message and exit
      --input-file INPUT_FILE
                            the input file
      --output-file OUTPUT_FILE
                            the output_file
      --rate RATE           the rate
      --retry RETRY

All declared arguments are required.

### DVC command

The generation of this command is optional.

It is based on data declared in **notebook metadata**,
 2 modes are available:
    - describe only input/output for simple cases
    - describe full command fro complex cases

#### Simple cases

Syntax
    
    [:dvc-[in|out][\s{related_param}]?:[\s{file_path}]?]*
    [:dvc-extra: {python_other_param}]?
    
    :dvc-in: ./data/filter.csv
    :dvc-in input_param: ./data/info.csv    
    :dvc-out: ./data/train_set.csv    
    :dvc-out output_param: ./data/test_set.csv
    :dvc-extra: --mode train --rate 12
       
Provided **{file_path}** path can be absolute or relative to the git top dir.

The **{related_param}** design a parameter of the corresponding python script,
 it is fill in for the python script call

The **dvc-extra** allow to declare parameter, to provide to the call of the python 
command, which are not dvc outputs or dependencies.
 
    pushd $(git rev-parse --show-toplevel)
    
    dvc run \
        -d ./data/filter.csv \
        -d ./data/info.csv \
        -o ./data/train_set.csv \
        -o ./data/test_set.csv \
        ../python/python_cmd --input-param ./data/info.csv --output-param ./data/test_set.csv \
                             --mode train --rate 12
        
    
#### Complex cases

Syntax
    
    :dvc-cmd: {dvc_command}

    :dvc-cmd: dvc run -o ./out_train.csv -o ./out_test.csv ./py_cmd -m train --out ./out_train.csv && ./py_cmd -m test --out ./out_test.csv
Allow to provide the full dvc command to generate. All paths can be absolute or relative to the git top dir.
 
    pushd $(git rev-parse --show-toplevel)
    
    dvc run -o ./out_train.csv -o ./out_test.csv ./py_cmd -m train --out ./out_train.csv && ./py_cmd -m test --out ./out_test.csv
    
    popd


### Discard cell

Some cells in **Jupyter Notebook** are executed only to watch intermediate results.
In a **Python 3** they are statements with no effect. 
The comment **# No effect** allow to discard a whole cell content to avoid waste of 
time running those statements.
